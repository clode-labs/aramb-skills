#!/bin/bash
#
# Pre-commit hook: Rebuild skill registry if skill.yaml files changed
#
# To install this hook:
#   git config core.hooksPath .githooks
#

# Check if any skill.yaml files are staged
SKILL_FILES=$(git diff --cached --name-only | grep 'skill\.yaml$')

if [ -n "$SKILL_FILES" ]; then
    echo "ğŸ”§ Skill files changed, rebuilding registry..."

    # Check if Python and pyyaml are available
    if ! python3 -c "import yaml" 2>/dev/null; then
        echo "âš ï¸  Warning: pyyaml not installed, skipping registry rebuild"
        echo "   Run: pip install pyyaml"
        exit 0
    fi

    # Rebuild registry
    python3 scripts/build_registry.py

    # Check if registry.yaml changed
    if ! git diff --quiet registry.yaml; then
        echo "ğŸ“ registry.yaml updated, adding to commit..."
        git add registry.yaml
    fi

    echo "âœ… Registry rebuild complete"
fi

exit 0
